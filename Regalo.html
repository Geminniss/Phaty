<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para mi Capy ðŸ’–</title>
    <style>
        :root {
            --primary-pink: #ff3366;
            --dark-pink: #b3002d;
            --gold: #ffd700;
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: radial-gradient(circle at top, #ff4e78, #4b0026);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 0; pointer-events: none; }

        #intro, .container { position: relative; z-index: 2; text-align: center; }

        /* BotÃ³n de control de mÃºsica */
        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 2px solid white;
            font-size: 24px;
            transition: 0.3s;
        }
        #music-control:hover { transform: scale(1.1); background: rgba(255, 255, 255, 0.4); }

        button {
            padding: 18px 40px;
            font-size: 24px;
            background: var(--primary-pink);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        button:hover { transform: scale(1.1); }

        .gift {
            width: 170px;
            height: 150px;
            background: #e60039;
            border-radius: 12px;
            position: relative;
            margin: 0 auto;
            cursor: pointer;
        }

        .lid {
            width: 180px;
            height: 45px;
            background: var(--dark-pink);
            position: absolute;
            top: -35px;
            left: -5px;
            border-radius: 10px;
            z-index: 2;
            transition: 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .open .lid { transform: translateY(-160px) rotate(-25deg); opacity: 0; }

        .ribbon-v { width: 35px; height: 100%; background: var(--gold); position: absolute; left: 67px; }
        .ribbon-h { width: 100%; height: 35px; background: var(--gold); position: absolute; top: 60px; }

        .surprise { display: none; margin-top: 20px; animation: popUp 1.2s forwards; }

        @keyframes popUp {
            from { opacity: 0; transform: scale(0.3) translateY(50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .image-container {
            position: relative;
            width: 280px;
            margin: 0 auto 20px;
            animation: sway 5s ease-in-out infinite;
        }

        .main-bouquet {
            width: 100%;
            border-radius: 25px;
            box-shadow: 0 15px 45px rgba(0,0,0,0.7);
            border: 4px solid rgba(255,255,255,0.2);
        }

        .image-container::before {
            content: '';
            position: absolute;
            width: 120%; height: 120%;
            background: radial-gradient(circle, rgba(255, 45, 85, 0.6) 0%, transparent 75%);
            top: -10%; left: -10%;
            border-radius: 40px;
            animation: magicPulse 3s infinite;
            z-index: -1;
        }

        @keyframes magicPulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; transform: scale(1.1); } }
        @keyframes sway { 0%, 100% { transform: rotate(-2deg); } 50% { transform: rotate(2deg); } }

        .sparkle {
            position: absolute; background: white; border-radius: 50%;
            box-shadow: 0 0 10px #fff, 0 0 15px var(--gold);
            animation: sparkleFloat 2.5s linear forwards;
            z-index: 10;
        }

        @keyframes sparkleFloat {
            0% { transform: translate(0,0) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translate(var(--x), -100px) scale(0); opacity: 0; }
        }

        .message { font-size: 30px; font-weight: bold; margin: 15px 0; text-shadow: 0 5px 10px rgba(0,0,0,0.5); }
        .letter { font-size: 19px; max-width: 360px; margin: 0 auto; line-height: 1.5; font-style: italic; background: rgba(0,0,0,0.2); padding: 20px; border-radius: 20px; backdrop-filter: blur(5px); }

        .heart { position: absolute; pointer-events: none; animation: floatUp 6s linear forwards; }
        @keyframes floatUp { from { transform: translateY(105vh); } to { transform: translateY(-15vh); opacity: 0; } }
    </style>
</head>
<body>

    <canvas id="particles"></canvas>

    <!-- Control de mÃºsica flotante -->
    <div id="music-control" onclick="toggleMusic()">ðŸ”Š</div>

    <div id="intro">
        <h1>ðŸ’˜ Capy, tengo algo para ti... ðŸ’˜</h1>
        <button onclick="start()">Entrar</button>
    </div>

    <div class="container" id="main" style="display:none;">
        <div class="gift" id="giftBox" onclick="openGift()">
            <div class="lid"></div>
            <div class="ribbon-v"></div>
            <div class="ribbon-h"></div>
        </div>

        <div class="surprise" id="surprise">
            <div class="image-container" id="magicArea">
                <img src="ramo.jpg" alt="Ramo para Capy" class="main-bouquet">
            </div>
            <div class="message">Â¡Feliz San ValentÃ­n, Capy! ðŸ’–</div>
            <div class="letter" id="letter"></div>
        </div>
    </div>

    <!-- RUTA LOCAL DE LA MÃšSICA -->
    <audio id="music" loop>
        <source src="musica.mp3" type="audio/mpeg">
    </audio>

<script>
    const state = { opened: false, i: 0, playing: false };
    const text = "Capy, hoy quiero recordarte lo especial que eres para mÃ­. Que este dÃ­a estÃ© lleno de magia y amor. Â¡Te quiero! ðŸŒ¹âœ¨";
    const music = document.getElementById("music");
    const mBtn = document.getElementById("music-control");

    function start() {
        document.getElementById("intro").style.display = "none";
        document.getElementById("main").style.display = "block";
    }

    function openGift() {
        if (state.opened) return;
        state.opened = true;
        document.getElementById("giftBox").classList.add("open");
        document.getElementById("surprise").style.display = "block";
        mBtn.style.display = "flex";
        
        playMusic();
        typeWriter();
        setInterval(createSparkle, 150);
        explodeMagic();
    }

    function playMusic() {
        music.play().then(() => {
            state.playing = true;
            mBtn.innerText = "ðŸ”Š";
        }).catch(e => console.log("MÃºsica en espera..."));
    }

    function toggleMusic() {
        if (state.playing) {
            music.pause();
            mBtn.innerText = "ðŸ”‡";
        } else {
            music.play();
            mBtn.innerText = "ðŸ”Š";
        }
        state.playing = !state.playing;
    }

    function typeWriter() {
        if (state.i < text.length) {
            document.getElementById("letter").innerHTML += text.charAt(state.i);
            state.i++;
            setTimeout(typeWriter, 50);
        }
    }

    function createSparkle() {
        const area = document.getElementById("magicArea");
        const s = document.createElement("div");
        s.className = "sparkle";
        const rect = area.getBoundingClientRect();
        s.style.left = (rect.left + Math.random() * rect.width) + "px";
        s.style.top = (rect.top + Math.random() * rect.height) + "px";
        s.style.setProperty('--x', (Math.random() * 60 - 30) + "px");
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 2500);
    }

    function explodeMagic() {
        for(let i=0; i<40; i++) {
            const h = document.createElement("div");
            h.innerHTML = ["ðŸ’–", "ðŸŒ¹", "âœ¨"][Math.floor(Math.random()*3)];
            h.className = "heart";
            h.style.left = "50vw"; h.style.top = "50vh";
            h.style.fontSize = "25px";
            h.style.transition = "2.5s ease-out";
            document.body.appendChild(h);
            setTimeout(() => {
                h.style.transform = `translate(${(Math.random()-0.5)*120}vw, ${(Math.random()-0.5)*120}vh) rotate(360deg)`;
                h.style.opacity = 0;
            }, 50);
            setTimeout(() => h.remove(), 2500);
        }
    }

    setInterval(() => {
        const h = document.createElement("div");
        h.className = "heart"; h.innerHTML = "ðŸ’–";
        h.style.left = Math.random() * 100 + "vw";
        h.style.fontSize = (Math.random() * 15 + 10) + "px";
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 6000);
    }, 800);

    const canvas = document.getElementById("particles");
    const ctx = canvas.getContext("2d");
    let pts = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.onresize = resize; resize();
    for(let i=0; i<80; i++) pts.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*2, d: Math.random()*0.4+0.1});
    function draw() {
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = "rgba(255,255,255,0.4)";
        pts.forEach(p => {
            ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, 7); ctx.fill();
            p.y += p.d; if(p.y > canvas.height) p.y = -5;
        });
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
